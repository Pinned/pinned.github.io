<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    
        <title>Android RelativeLayout 之 Gravity 的使用 </title>
    
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/markdown.css">

    
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <p class="post-title">Android RelativeLayout 之 Gravity 的使用</p>
</div>
                
                <div class="post-main">

    
        <div class="post-meta">
            <a class='author' href="/">罗昭成</a> <span id="clipboardbtn" 
            data-clipboard-action="copy"
            data-clipboard-target="#copy-post-content"
            >2015年12月29日</span>
        </div>
        <div class="post-md" id="copy-post-content">
            <p>在xml中，ViewGroup用来控制view布局位置，我们可以使用<code>android:gravity=&quot;center&quot;</code>来实现。但是很少会在RelativeLayout中使用，今天碰到了一个项目中的布局使用了这个属性。但是在印象中这个属性在RelativeLayout是不生效的。但是，在项目中，这个属性生效了，并且引起了一个问题。去百度了一下，好多人在博客里面写的这个属性在RelativeLayout不生效，在这里，我在强调一下，<strong>RelativeLayout中andorid:gravity属性是<font color='red'>生效</font>的</strong></p>
<p>so，我们先来看一下，布局代码是怎么写的：</p>
<p><strong>activity_main.xml</strong></p>
<pre><code class="xml">&lt;RelativeLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;100dp&quot;
    android:background=&quot;@android:color/holo_blue_bright&quot;
    android:gravity=&quot;center&quot;
    tools:context=&quot;.MainActivity&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/center_view&quot;
        android:layout_width=&quot;100dp&quot;
        android:layout_height=&quot;50dp&quot;
        android:background=&quot;@android:color/holo_green_light&quot;
        android:gravity=&quot;center&quot;
        android:layout_centerInParent=&quot;true&quot;
        android:text=&quot;@string/hello_world&quot;/&gt;

    &lt;TextView
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:background=&quot;@android:color/holo_orange_light&quot;
        android:layout_below=&quot;@id/center_view&quot;
        android:layout_centerHorizontal=&quot;true&quot;
        android:layout_marginTop=&quot;6dp&quot;
        android:padding=&quot;6dp&quot;
        android:text=&quot;下面的文本&quot;/&gt;

&lt;/RelativeLayout&gt;
</code></pre>
<p>代码很简单，那我们在来看一下他的运行效果：</p>
<p><img src="https://cloud.githubusercontent.com/assets/8403321/12022795/46c90190-adce-11e5-8cfd-f39a8d1fd4a1.png" alt="效果图"></p>
<p>我那个擦，为什么下面那个TextView上的文字内容显示不完整，这尼玛什么情况，于是乎，我调整了一个<code>RelativeLayout</code>的高度，让他变高一点，改成<code>android:layout_height=&quot;125dp&quot;</code>, run了一下，居然正常了，如下图：<br><img src="https://cloud.githubusercontent.com/assets/8403321/12022788/299ea278-adce-11e5-93c7-104e82cbf6fb.png" alt="效果图"></p>
<p>我特么的惊呆了，内心中一万只草泥马奔腾而过，上面那个图中，RelativeLayout中明明还有空白，为什么会导致下面的TextView的高度不够呢。</p>
<p>带着疑惑，我去看了一下Android RelativeLayout的源码，才发现，RelativeLayout 先按照不写gravity属性的时候来计算子View的高度：</p>
<pre><code class="html">在Nexcus下调试，得到控件的高度：
1.首先得到RelativeLayout的高度为200px
2.写Hello World!的TextView的height为100px
3.可以得到最下面的那个TextView 的高度为：
  height &lt;= 200px / 2 - 100px / 2 - marginTop(12px) = 48px = 24dp
  很明显，24个dp不够显示TextView的内容
  
那加了gravity属性过后，RelativeLayout将所有的Content作为一个整体，作了个居中，如下：
得到两个了控件的高度过后，就得到RelativeLayout 的contentHeight:

contentHeight = 100px + 12px + 48px = 160px
就可以得到上下的宽度分别为20px
</code></pre>
<p>RelativeLayout中源码实现：</p>
<pre><code class="java">@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;
    
    // 1. 判断是否有水平gravity与垂直gravity属性
    // 2. 排序子View，并计算子View的大小
    if (horizontalGravity || verticalGravity) &#123; //如果有
        final Rect selfBounds = mSelfBounds;
        selfBounds.set(mPaddingLeft, mPaddingTop, width - mPaddingRight,
                height - mPaddingBottom);

        final Rect contentBounds = mContentBounds;
        Gravity.apply(mGravity, right - left, bottom - top, selfBounds, contentBounds,
                layoutDirection);

        final int horizontalOffset = contentBounds.left - left;
        final int verticalOffset = contentBounds.top - top;
        if (horizontalOffset != 0 || verticalOffset != 0) &#123;
            for (int i = 0; i &lt; count; i++) &#123;
                final View child = views[i];
                if (child.getVisibility() != GONE &amp;&amp; child != ignore) &#123;
                    final LayoutParams params = (LayoutParams) child.getLayoutParams();
                    if (horizontalGravity) &#123;
                        params.mLeft += horizontalOffset;
                        params.mRight += horizontalOffset;
                    &#125;
                    if (verticalGravity) &#123;
                        params.mTop += verticalOffset;
                        params.mBottom += verticalOffset;
                    &#125;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p>所以，虽然下面有空隙，TextView 也拿到到足够的空间进行展示，导致TextView中的内容显示不完整</p>

        </div>

    

</div>
                <!-- 
                    <div class="post_pre_next">
    
        <div class="post-pre">
            <a href="/2016/10/10/Shell-Sub-String/">上一篇: Shell脚本8种字符串截取方法</a>
        </div>
    
    
        <a href="/2015/12/22/gradle-download-error/">下一篇: 
            Android Studio Gradle Download Error
        </a>
    
</div>


                 -->
                <div class="footer">
    <span>Copyright © 2023 大罗说事</span>
</div>

<!-- 
<link rel="stylesheet" href="/css/highlight.default.css">
 -->

<link rel="stylesheet" href="/css/atom-one-dark.css">


<link rel="stylesheet" href="/css/code-theme.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>


<script src="/js/clipboard.min.js"></script>


<script>
    hljs.highlightAll();
    var clipboard = new ClipboardJS('#clipboardbtn');
    clipboard.on('success', function (e) {
        console.log("Copied")
        e.clearSelection();  
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>

            </div>
        </div>
    </body>
</html>