<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>大罗说事</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Talk is cheap, show me the code.">
<meta property="og:type" content="website">
<meta property="og:title" content="大罗说事">
<meta property="og:url" content="http://pinned.github.io/page/6/index.html">
<meta property="og:site_name" content="大罗说事">
<meta property="og:description" content="Talk is cheap, show me the code.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="罗昭成">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="大罗说事" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">大罗说事</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://pinned.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2014-9-21-Navicat install" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2014-9-21-Navicat%20install/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2014-9-21-Navicat%20install/">Ubuntu 下安装Navicat</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Navicat的安装"><a href="#Navicat的安装" class="headerlink" title="Navicat的安装"></a>Navicat的安装</h2><p>在使用Mysql的时候，一开始就喜欢使用Navicat，所以就想安装一个<br>Navicat来使用。</p>
<p>很简单，去Navicat官网下一个下来，解压就可以用了。</p>
<p>步骤如下：</p>
<ol>
<li>解压文件<br> <code>tar -xzvf navicat_xxx.tar.gz</code></li>
<li>进入到解压好的文件夹中，运行就可以了<code>./start_navicat</code></li>
</ol>
<p>但是不知道为什么，运行没有任何反应。</p>
<p>在google上查找了一下，才知道是没有安装32位库和wine环境</p>
<p>打开<strong>synaptic</strong>,然后在<strong>Setting-&gt;Repros</strong>，打开界面中</p>
<p>选择其它软件源，添加:<br><code>deb http://old-releases.ubuntu.com/ubuntu/ raring main restricted universe multiverse</code></p>
<p>保存，退出。</p>
<p>然后执行命令:</p>
<pre><code class="xml">sudo apt-get install libgtk2.0-0:i386
sudo apt-get -f install
sudo apt-get install wine
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2014-9-21-Navicat%20install/" data-id="cli8ygt7a001m9y27egew6lvv" data-title="Ubuntu 下安装Navicat" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2014-12-24-git-checkout" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2014-12-24-git-checkout/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2014-12-24-git-checkout/">git checkout 的使用（一）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在使用git的过程中，有很多好的点</p>
<p>其中，我们使用<code>git-flow</code>模型</p>
<p>我的小伙伴创建了一个<code>branch</code></p>
<blockquote>
<p>feature&#x2F;branch_test</p>
</blockquote>
<p>在这个地方，我想切换到<code>branch_test</code>分支</p>
<p>我使用如下命令：</p>
<pre><code class="html"> git checkout remotes/origin/feature/branch_test
 
 git checkout origin/feature/branch_test
 
</code></pre>
<p>使用上面两句命令都不得行，都只创建了一个临时分支。输出如下：</p>
<pre><code class="html">
Note: checking out &#39;origin/feature/branch_test&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b new_branch_name
</code></pre>
<p>后面的解决办法是使用如下命令：</p>
<pre><code class="html">git checkout reature/branch_test
</code></pre>
<p>不是什么高深的技术，只是记录一下。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2014-12-24-git-checkout/" data-id="cli8ygt7a001p9y27emfj69jw" data-title="git checkout 的使用（一）" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2015-01-16-textview-url-lickify-02" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-16-textview-url-lickify-02/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-16-textview-url-lickify-02/">TextView高亮URL地址解析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>#TextView 高亮实现</p>
<p>基本使用方法：</p>
<pre><code class="java">textView.setAutoLinkMask(Linkify.ALL);
//public static final int WEB_URLS = 1;
//public static final int EMAIL_ADDRESSES = 2;
//public static final int PHONE_NUMBERS = 4;
//public static final int MAP_ADDRESSES = 8; 
//public static final int ALL = 15;
textView.setMovementMethod(LinkMovementMethod.getInstacne());
</code></pre>
<p><code>setMovementMethod()</code>是设置相应点击跳转时间触发用的。</p>
<p>去研究了一下<code>TextView</code>的源码。URL地址匹配实际上是用的正则做的。<br>所以我们也能很简单的实现这个东西。</p>
<p>#修改源码，实现自己的高亮和自定义跳转</p>
<p>首先拿到我们要显示的字符串，创建<code>Spannable</code>对象：</p>
<pre><code class="java">private Spannable.Factory mSpannableFactory = Spannable.Factory.getInstance();
Spannable spannable = mSpannableFactory.newSpannable(pili.description);
</code></pre>
<p>然后我们要去拿到的<code>spannable</code>进行处理，将我们要高亮的数据<code>正则匹配</code>出来。</p>
<ol>
<li>先移除掉<code>spannable</code>中已经存在的<code>URLSpan</code></li>
</ol>
<pre><code class="java">  URLSpan[] old = text.getSpans(0, text.length(), URLSpan.class);
  for (int i = old.length - 1; i &gt;= 0; i--) &#123;
    text.removeSpan(old[i]);
  &#125;
</code></pre>
<ol start="2">
<li>匹配URL地址，并设置<code>Spannable</code></li>
</ol>
<pre><code class="java">public static final Linkify.MatchFilter sUrlMatchFilter = new Linkify.MatchFilter() &#123;
         public final boolean acceptMatch(CharSequence s, int start, int end) &#123;
         if (start == 0) &#123;
             return true;
         &#125;

         if (s.charAt(start - 1) == &#39;@&#39;) &#123;
             return false;
         &#125;
         return true;
         &#125;
&#125;;
private static final String makeUrl(String url, String[] prefixes,
                                      Matcher m, Linkify.TransformFilter filter) &#123;
      if (filter != null) &#123;
          url = filter.transformUrl(m, url);
      &#125;

      boolean hasPrefix = false;

      for (int i = 0; i &lt; prefixes.length; i++) &#123;
          if (url.regionMatches(true, 0, prefixes[i], 0,
                  prefixes[i].length())) &#123;
              hasPrefix = true;

              // Fix capitalization if necessary
              if (!url.regionMatches(false, 0, prefixes[i], 0,
                      prefixes[i].length())) &#123;
                  url = prefixes[i] + url.substring(prefixes[i].length());
              &#125;

              break;
          &#125;
      &#125;

      if (!hasPrefix) &#123;
          url = prefixes[0] + url;
      &#125;
      return url;
  &#125;
  
  private final void gatherLinks(ArrayList&lt;LinkSpec&gt; links,
                                       Spannable s, Pattern pattern, String[] schemes,
                                       Linkify.MatchFilter matchFilter, 
                                       Linkify.TransformFilter transformFilter) &#123;
     Matcher m = pattern.matcher(s); // 正则匹配，使用Patterns.WEB_URL
     while (m.find()) &#123;
         int start = m.start();
         int end = m.end();

         if (matchFilter == null || matchFilter.acceptMatch(s, start, end)) &#123;
             LinkSpec spec = new LinkSpec();
             String url = makeUrl(m.group(0), schemes, m, transformFilter);
             spec.url = url;
             spec.start = start;
             spec.end = end;
             links.add(spec);
         &#125;
     &#125;
   &#125;
   class LinkSpec &#123;
      String url;
      int start;
      int end;
  &#125;
</code></pre>
<pre><code class="java">  private final void applyLink(String url, int start, int end, Spannable text) &#123;
      URLSpanNoUnderline span = new URLSpanNoUnderline(url);
      text.setSpan(span, start, end, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
  &#125;
  public class URLSpanNoUnderline extends ClickableSpan &#123;
      private final String mURL;
      public URLSpanNoUnderline(String url) &#123;
          mURL = url;
      &#125;

      public String getURL() &#123;
          return mURL;
      &#125;

      @Override
      public void onClick(View widget) &#123;
          final Context context = widget.getContext();
          BrowserActivity.startActivity(context, mURL);
      &#125;
      @Override
      public void updateDrawState(TextPaint ds) &#123;
          super.updateDrawState(ds);
          ds.setUnderlineText(false);  //取消下划线
          ds.setColor(0xff0066ff);     //指定文字颜色
          //ds.setTextSize(ds.getTextSize()*1.1F);
      &#125;
  &#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-16-textview-url-lickify-02/" data-id="cli8ygt7a001s9y27384w0tfi" data-title="TextView高亮URL地址解析" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2015-01-17-advance-textview-using" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-17-advance-textview-using/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-17-advance-textview-using/">Advanced Android TextView</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>TextView是一个经常使用的组件，但是你并不一定完全知道他的<br>详细使用方法及具体细节。</p>
<p>在github上面看到一个PPT，详细的写到了TextView的用法。</p>
<p><strong>参考地址:</strong> <a target="_blank" rel="noopener" href="http://chiuki.github.io/advanced-android-textview/#/">Advanced Android TextView</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-17-advance-textview-using/" data-id="cli8ygt7b001v9y279iugdgy7" data-title="Advanced Android TextView" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2015-01-15-textview-url-lickify" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-15-textview-url-lickify/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-15-textview-url-lickify/">TextView 高亮URL地址，并实现跳转</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Android-TextView-使用"><a href="#Android-TextView-使用" class="headerlink" title="Android TextView 使用"></a>Android TextView 使用</h1><p>TextView的使用中，存在很多高级功能。比如高亮URL地址、电话号码等</p>
<p>使用方法：</p>
<pre><code class="java">TextView tempText = new TextView(context);
tempText.setText(&quot;www.baidu.com&quot;);
tempText.setAutoLinkMask(Linkify.WEB_URLS);
tempText.setMovementMethod(LinkMovementMethod.getInstance());
</code></pre>
<p>但是我在使用过程中，要跳转到自己的Webview中去，又不想去解析字符串，提取里面的URL地址<br>所以我想了个简单的解决方案.</p>
<h1 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h1><pre><code class="java">TextView tempText = new TextView(context);
tempText.setText(&quot;www.baidu.com&quot;);
SpannableStringBuilder style = new SpannableStringBuilder(pili.description);
tempText.setAutoLinkMask(Linkify.WEB_URLS);
tempText.setMovementMethod(LinkMovementMethod.getInstance());
URLSpan [] urls = tempText.getUrls();
if (urls == null || urls.length &lt;= 0) &#123;
    text.setText(pili.description);
&#125; else &#123;
    for (URLSpan urlSpan : urls) &#123;
        String url = urlSpan.getURL();
        int n = pili.description.indexOf(url);
        if (n &lt; 0) &#123;
            // 去掉前面的HTTP
            url = url.substring(7);
            n = pili.description.indexOf(url);
        &#125;
        if (n &lt; 0) &#123;
            continue;
        &#125;
        style.setSpan(new URLSpanNoUnderline(urlSpan.getURL()), n, url.length(), Spanned.SPAN_EXCLUSIVE_INCLUSIVE);
    &#125;
    text.setText(style);
    text.setMovementMethod(LinkMovementMethod.getInstance());
&#125;
</code></pre>
<pre><code class="java">public class URLSpanNoUnderline extends ClickableSpan &#123;
    private final String mURL;
    public URLSpanNoUnderline(String url) &#123;
        mURL = url;
    &#125;

    public String getURL() &#123;
        return mURL;
    &#125;

    @Override
    public void onClick(View widget) &#123;
        final Context context = widget.getContext();
        BrowserActivity.startActivity(context, mURL);
    &#125;
    @Override
    public void updateDrawState(TextPaint ds) &#123;
        super.updateDrawState(ds);
        ds.setUnderlineText(false);  //取消下划线
        ds.setColor(0xff0066ff);     //指定文字颜色
        //ds.setTextSize(ds.getTextSize()*1.1F);
    &#125;
&#125;
</code></pre>
<p>就是如此的简单，但是为了弄这个东西，还是花了不少时间。</p>
<p>这种方法虽然可以实现功能，但是我觉得这样子做并不好。如果你有更好的解决方案。<br>望赐教，不胜感激。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-15-textview-url-lickify/" data-id="cli8ygt7b001y9y27dud6c8eq" data-title="TextView 高亮URL地址，并实现跳转" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="book-2015-01-22-book-list-of-2015" class="h-entry article article-type-book" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-22-book-list-of-2015/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-22-book-list-of-2015/">2015阅读书单</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-22-book-list-of-2015/" data-id="cli8ygt7b00219y27fat310nl" data-title="2015阅读书单" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2015-01-23-google-volley-url-cache-key" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-23-google-volley-url-cache-key/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">开源项目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-23-google-volley-url-cache-key/">Google Volley如何缓存HTTP请求文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>HTTP请求，是一个很长见的过程，缓存也是一个不可避免的话题。一个有好的HTTP请<br>求，肯定会有它自己的一套缓存机制。我们要如何来做，即能方便，又能快速的实现这<br>个功能呢？</p>
<h1 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h1><p>以前，自己也封装过一些简陋的HTTP框架，有的在HTTP框架中做过数据缓存，有的没有<br>做过数据缓存。</p>
<ul>
<li><p>没有做数据缓存</p>
<p>  在没有做数据缓存的时候，将HTTP请求的Response响应到UI之前作数据预处理，并且此过程的处理放到子线程中进行，不占用UI线程。这样可以很方便的让用户选择如何进行数据缓存，以及缓存侧略。</p>
</li>
<li><p>做数据缓存</p>
<p>  在本处，做数据缓存，有一个通用的做法就是将HTTP请求的Response作为文件来存储。虽然很简单，但是还是有一个小的细节需要注意，那就是如何建立HTTP请求与文件之间的映射。前面我去面试的时候，也遇到过这个问题。我的想法如下：</p>
<ul>
<li><p>直接使用URL地址作为文件名称，考虑到URL地址有可能存在过长的情况，可以使用URL<br>地址的<code>MD5</code>值来作为KEY</p>
</li>
<li><p>建立数据库，用来存储URL地址与文件名的映射关系，文件名使用<code>UUID</code>来存储</p>
</li>
</ul>
</li>
</ul>
<p>上述两种办法是可行的，但是好不好，我就不好说了。毕竟个人能力有限。</p>
<p>#Google Volley 缓存HTTP请求到文件中</p>
<p>先看代码：</p>
<pre><code class="java">while (true) &#123;
  Request&lt;?&gt; request;
  try &#123;
      // Take a request from the queue.
      request = mQueue.take();
  &#125; catch (InterruptedException e) &#123;
      // We may have been interrupted because it was time to quit.
      if (mQuit) &#123;
          return;
      &#125;
      continue;
  &#125;

  try &#123;
      request.addMarker(&quot;network-queue-take&quot;);

      // If the request was cancelled already, do not perform the
      // network request.
      if (request.isCanceled()) &#123;
          request.finish(&quot;network-discard-cancelled&quot;);
          continue;
      &#125;

      addTrafficStatsTag(request);

      // Perform the network request.
      NetworkResponse networkResponse = mNetwork.performRequest(request);
      request.addMarker(&quot;network-http-complete&quot;);

      // If the server returned 304 AND we delivered a response already,
      // we&#39;re done -- don&#39;t deliver a second identical response.
      if (networkResponse.notModified &amp;&amp; request.hasHadResponseDelivered()) &#123;
          request.finish(&quot;not-modified&quot;);
          continue;
      &#125;

      // Parse the response here on the worker thread.
      Response&lt;?&gt; response = request.parseNetworkResponse(networkResponse);
      request.addMarker(&quot;network-parse-complete&quot;);

      // Write to cache if applicable.
      // TODO: Only update cache metadata instead of entire record for 304s.
      if (request.shouldCache() &amp;&amp; response.cacheEntry != null) &#123;
          mCache.put(request.getCacheKey(), response.cacheEntry);
          request.addMarker(&quot;network-cache-written&quot;);
      &#125;

      // Post the response back.
      request.markDelivered();
      mDelivery.postResponse(request, response);
  &#125; catch (VolleyError volleyError) &#123;
      parseAndDeliverNetworkError(request, volleyError);
  &#125; catch (Exception e) &#123;
      VolleyLog.e(e, &quot;Unhandled exception %s&quot;, e.toString());
      mDelivery.postError(request, new VolleyError(e));
  &#125;
&#125;
</code></pre>
<p>如上述代码，先从<code>mQuene</code>中拿出一个<code>Request</code>，然后经过一系列的预处理，分发出网络请求。</p>
<p>在下述地方进行了数据缓存：</p>
<pre><code class="java">if (request.shouldCache() &amp;&amp; response.cacheEntry != null) &#123;
    mCache.put(request.getCacheKey(), response.cacheEntry);
    request.addMarker(&quot;network-cache-written&quot;);
&#125;
</code></pre>
<p>如果当前的<code>Request</code>是应该被缓存（PS:request 默认是要进行数据缓存的），并且<code>cache</code>不为空<br>的时候，进行数据缓存。</p>
<p>紧接着便是把数据写到文件里面去，代码如下：</p>
<pre><code class="java">/**
 * Puts the entry with the specified key into the cache.
 */
@Override
public synchronized void put(String key, Entry entry) &#123;
    pruneIfNeeded(entry.data.length);
    File file = getFileForKey(key);
    try &#123;
        FileOutputStream fos = new FileOutputStream(file);
        CacheHeader e = new CacheHeader(key, entry);
        boolean success = e.writeHeader(fos);
        if (!success) &#123;
            fos.close();
            VolleyLog.d(&quot;Failed to write header for %s&quot;, file.getAbsolutePath());
            throw new IOException();
        &#125;
        fos.write(entry.data);
        fos.close();
        putEntry(key, e);
        return;
    &#125; catch (IOException e) &#123;
    &#125;
    boolean deleted = file.delete();
    if (!deleted) &#123;
        VolleyLog.d(&quot;Could not clean up file %s&quot;, file.getAbsolutePath());
    &#125;
&#125;
</code></pre>
<p>代码很简单，就是通过<code>key</code>来生成一个对应的文件名，然后将我们要<code>cache</code>的数据存储到文件中。</p>
<p>先看一下<code>request.getCacheKey()</code>的默认实现：</p>
<pre><code class="java">/**
 * Returns the URL of this request.
 */
public String getUrl() &#123;
    return mUrl;
&#125;

/**
 * Returns the cache key for this request.  By default, this is the URL.
 */
public String getCacheKey() &#123;
    return getUrl();
&#125;
</code></pre>
<p>我那个X，它的默认实现就是直接取的URL地址。下面我们在看一下<code>getFileForKey(key)</code>是如何实现<br>的。</p>
<pre><code class="java">
/**
 * Creates a pseudo-unique filename for the specified cache key.
 * @param key The key to generate a file name for.
 * @return A pseudo-unique filename.
 */
private String getFilenameForKey(String key) &#123;
    int firstHalfLength = key.length() / 2;
    String localFilename = String.valueOf(key.substring(0, firstHalfLength).hashCode());
    localFilename += String.valueOf(key.substring(firstHalfLength).hashCode());
    return localFilename;
&#125;

/**
 * Returns a file object for the given cache key.
 */
public File getFileForKey(String key) &#123;
    return new File(mRootDirectory, getFilenameForKey(key));
&#125;
</code></pre>
<p>可以看到，文件名的取值是将URL地址分成两部分，分别取<code>hashcode</code>然后在合在一起行成一个字符串。</p>
<p>存储HTTP请求缓存竟然如些的简单，为何我不曾想到呢。</p>
<blockquote>
<p>PS: 这个地方为什么要分成两部分来取hashcode值呢?我也不知道，我猜是为了尽可能唯一吧。</p>
</blockquote>
<p>#Google Volley 使用本地缓存</p>
<p>如果你读过<code>Volley</code>的源码，想必你肯定知道，在<code>Volley</code>初始化的时候，创建了一个<br><code>CacheDispatcher</code>和五个<code>NetworkDispatcher</code></p>
<p>当一个<code>Request</code>通过<code>RequestQuene.add</code>添加进来的时候，首先是将<code>Request</code>放入到缓存队列里面<br>去的，除非这个请求被设置成不使用缓存，先看下<code>add</code>的源码：</p>
<pre><code class="java">/**
 * Adds a Request to the dispatch queue.
 * @param request The request to service
 * @return The passed-in request
 */
public &lt;T&gt; Request&lt;T&gt; add(Request&lt;T&gt; request) &#123;
    // Tag the request as belonging to this queue and add it to the set of current requests.
    request.setRequestQueue(this);
    synchronized (mCurrentRequests) &#123;
        mCurrentRequests.add(request);
    &#125;

    // Process requests in the order they are added.
    request.setSequence(getSequenceNumber());
    request.addMarker(&quot;add-to-queue&quot;);

    // If the request is uncacheable, skip the cache queue and go straight to the network.
    if (!request.shouldCache()) &#123;
        mNetworkQueue.add(request);
        return request;
    &#125;

    // Insert request into stage if there&#39;s already a request with the same cache key in flight.
    synchronized (mWaitingRequests) &#123;
        String cacheKey = request.getCacheKey();
        if (mWaitingRequests.containsKey(cacheKey)) &#123;
            // There is already a request in flight. Queue up.
            Queue&lt;Request&lt;?&gt;&gt; stagedRequests = mWaitingRequests.get(cacheKey);
            if (stagedRequests == null) &#123;
                stagedRequests = new LinkedList&lt;Request&lt;?&gt;&gt;();
            &#125;
            stagedRequests.add(request);
            mWaitingRequests.put(cacheKey, stagedRequests);
            if (VolleyLog.DEBUG) &#123;
                VolleyLog.v(&quot;Request for cacheKey=%s is in flight, putting on hold.&quot;, cacheKey);
            &#125;
        &#125; else &#123;
            // Insert &#39;null&#39; queue for this cacheKey, indicating there is now a request in
            // flight.
            mWaitingRequests.put(cacheKey, null);
            mCacheQueue.add(request);
        &#125;
        return request;
    &#125;
&#125;
</code></pre>
<p>可以很清淅的看出来。如果在等待队列中已经有相同<code>cacheKey</code>的request,只需要将它加入到等侍队列中去就行了。</p>
<p>在来看一下，在<code>CacheDispatcher</code>中是如何做数据分发的。</p>
<ul>
<li>首先是读取当前已经存在的缓存文件</li>
</ul>
<pre><code class="java">  /**
  * Initializes the DiskBasedCache by scanning for all files currently in the
  * specified root directory. Creates the root directory if necessary.
  */
 @Override
 public synchronized void initialize() &#123;
     if (!mRootDirectory.exists()) &#123;
         if (!mRootDirectory.mkdirs()) &#123;
             VolleyLog.e(&quot;Unable to create cache dir %s&quot;, mRootDirectory.getAbsolutePath());
         &#125;
         return;
     &#125;

     File[] files = mRootDirectory.listFiles();
     if (files == null) &#123;
         return;
     &#125;
     for (File file : files) &#123;
         BufferedInputStream fis = null;
         try &#123;
             fis = new BufferedInputStream(new FileInputStream(file));
             CacheHeader entry = CacheHeader.readHeader(fis);
             entry.size = file.length();
             putEntry(entry.key, entry);
         &#125; catch (IOException e) &#123;
             if (file != null) &#123;
                file.delete();
             &#125;
         &#125; finally &#123;
             try &#123;
                 if (fis != null) &#123;
                     fis.close();
                 &#125;
             &#125; catch (IOException ignored) &#123; &#125;
         &#125;
     &#125;
 &#125;
</code></pre>
<p>直接遍历整个文件夹，将其加入内存，也是蛮拼的。</p>
<ul>
<li>缓存队列的执行</li>
</ul>
<pre><code class="java">final Request&lt;?&gt; request = mCacheQueue.take();
request.addMarker(&quot;cache-queue-take&quot;);
// If the request has been canceled, don&#39;t bother dispatching it.
if (request.isCanceled()) &#123;
    request.finish(&quot;cache-discard-canceled&quot;);
    continue;
&#125;

// Attempt to retrieve this item from cache.
Cache.Entry entry = mCache.get(request.getCacheKey());
if (entry == null) &#123;
    request.addMarker(&quot;cache-miss&quot;);
    // Cache miss; send off to the network dispatcher.
    mNetworkQueue.put(request);
    continue;
&#125;

// If it is completely expired, just send it to the network.
if (entry.isExpired()) &#123;
    request.addMarker(&quot;cache-hit-expired&quot;);
    request.setCacheEntry(entry);
    mNetworkQueue.put(request);
    continue;
&#125;

// We have a cache hit; parse its data for delivery back to the request.
request.addMarker(&quot;cache-hit&quot;);
Response&lt;?&gt; response = request.parseNetworkResponse(
        new NetworkResponse(entry.data, entry.responseHeaders));
request.addMarker(&quot;cache-hit-parsed&quot;);

if (!entry.refreshNeeded()) &#123;
    // Completely unexpired cache hit. Just deliver the response.
    mDelivery.postResponse(request, response);
&#125; else &#123;
    // Soft-expired cache hit. We can deliver the cached response,
    // but we need to also send the request to the network for
    // refreshing.
    request.addMarker(&quot;cache-hit-refresh-needed&quot;);
    request.setCacheEntry(entry);

    // Mark the response as intermediate.
    response.intermediate = true;

    // Post the intermediate response back to the user and have
    // the delivery then forward the request along to the network.
    mDelivery.postResponse(request, response, new Runnable() &#123;
        @Override
        public void run() &#123;
            try &#123;
                mNetworkQueue.put(request);
            &#125; catch (InterruptedException e) &#123;
                // Not much we can do about this.
            &#125;
        &#125;
    &#125;);
&#125;
</code></pre>
<p>从内存中找对应的<code>cache</code>,如果<code>entry == null</code>，将<code>Request</code>加入<code>Network Queue</code>。<br>如果<code>entry.isExpired</code>，将<code>Request</code>加入到<code>Network Queue</code>。<br>当然，如果读取到数据是需要刷新的，也是要加入到<code>Network Queue</code>。</p>
<p>当然，还有最后一个问题，这尼玛，这个<code>Entry</code>到底是怎么来的。</p>
<p>我仔细研究了一下代码才找到，他是在我们<code>Requet</code>的<code>parseNetworkResponse</code>中实现的，代码如下：</p>
<pre><code class="java">@Override
protected Response&lt;String&gt; parseNetworkResponse(NetworkResponse response) &#123;
    String parsed;
    try &#123;
        parsed = new String(response.data, HttpHeaderParser.parseCharset(response.headers));
    &#125; catch (UnsupportedEncodingException e) &#123;
        parsed = new String(response.data);
    &#125;
    return Response.success(parsed, HttpHeaderParser.parseCacheHeaders(response));
&#125;
</code></pre>
<p>就是<code>HttpHeaderParser.parseCacheHeaders(response)</code>实现<code>Response</code>向<code>Cache.Entry</code>的转换。</p>
<p>当然，你可以实现自己的<code>parseCacheHeaders</code>的方法，来实现你自己的缓存侧略。</p>
<p>到此为止，基本写完了我所读到的<code>Volley</code>中实现<code>Cache</code>的方法。如果你对本文或者我有什么意见或者建议。<br>请骚扰我：<a href="mailto:&#x6c;&#x6f;&#118;&#x65;&#99;&#x6c;&#117;&#111;&#64;&#110;&#x69;&#103;&#104;&#116;&#x77;&#101;&#97;&#118;&#x65;&#114;&#x2e;&#111;&#x72;&#x67;">&#x6c;&#x6f;&#118;&#x65;&#99;&#x6c;&#117;&#111;&#64;&#110;&#x69;&#103;&#104;&#116;&#x77;&#101;&#97;&#118;&#x65;&#114;&#x2e;&#111;&#x72;&#x67;</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-23-google-volley-url-cache-key/" data-id="cli8ygt7c00289y2709ht0l5s" data-title="Google Volley如何缓存HTTP请求文件" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2015-01-19-Android-log" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2015-01-19-Android-log/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.140Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2015-01-19-Android-log/">Creating logs in Android applications</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>For Android applications, logging is handled by the android.util.Log class, which is a basic logging class that stores the logs in a circular buffer for the whole device. All logs for the device can be seen in the LogCat tab in Eclipse, or read using the logcat command. Here is a standard log output for the LogCat tab in Eclipse :</p>
<p><img src="/assets/posts/img-2015-01-19/image.png" alt="Eclipse Image"></p>
<p>There are five levels of logs you can use in your application, for the most verbose to the least verbose :</p>
<ul>
<li><strong>Verbose</strong>: For extra information messages that are only compiled in a debug application, but never included in a release application.</li>
<li><strong>Debug</strong>: For debug log messages that are always compiled, but stripped at runtime in a release application.</li>
<li><strong>Info</strong>: For an information in the logs that will be written in debug and release.</li>
<li><strong>Warning</strong>: For a warning in the logs that will be written in debug and release.</li>
<li><strong>Error</strong>: For an error in the logs that will be written in debug and release.</li>
</ul>
<p>A log message includes a tag identifying a group of messages and the message. By default the log level of all tags is Info, which means than messages that are of level Debug and Verbose should never shown unless the setprop command is used to change the log level. So, to write a verbose message to the log, you should call the isLoggable method to check if the message can be logged, and call the logging method :</p>
<pre><code class="java">if (!Log.isLoggable(logMessageTag, Log.Verbose))
   Log.v(&quot;MyApplicationTag&quot;, logMessage);
</code></pre>
<p>And to show the Debug and Verbose log message for a specific tag, run the setprop command while your device is plugged in. If you reboot the device you will have to run the command again.</p>
<pre><code class="html">adb shell setprop log.tag.MyApplicationTag VERBOSE
</code></pre>
<p>Unfortunately, starting  with Android 4.0, an application can only read its own logs. It was useful for debugging to be able to read logs from another application, but in some cases sensitive information was written in those logs, and malicious apps were created to retrieve them. So if you need to have logs files send to you for debugging, you will need to create your own log class using the methods from the android.util.Log class. Remember, only Info, Warning and Error logs should be shown when the application is not run in debug mode.  Here is an example of a simple logger wrapping the call to isLoggable and storing the logs messages on the primary storage of the device (requires the permission WRITE_EXTERNAL_STORAGE) and to the standard buffer :</p>
<pre><code class="java">/**
  * A logger that uses the standard Android Log class to log exceptions, and also logs them to a 
  * file on the device. Requires permission WRITE_EXTERNAL_STORAGE in AndroidManifest.xml.
  * @author Cindy Potvin
  */
 public class Logger
 &#123;
 /**
   * Sends an error message to LogCat and to a log file.
   * @param context The context of the application.
   * @param logMessageTag A tag identifying a group of log messages. Should be a constant in the 
   *                      class calling the logger.
   * @param logMessage The message to add to the log.
   */
 public static void e(Context context, String logMessageTag, String logMessage) 
    &#123;
    if (!Log.isLoggable(logMessageTag, Log.ERROR))
       return;

    int logResult = Log.e(logMessageTag, logMessage);
    if (logResult &gt; 0) 
       logToFile(context, logMessageTag, logMessage);
    &#125;

/**
   * Sends an error message and the exception to LogCat and to a log file.
   * @param context The context of the application.
   * @param logMessageTag A tag identifying a group of log messages. Should be a constant in the 
   *                      class calling the logger.
   * @param logMessage The message to add to the log.
   * @param throwableException An exception to log
   */
 public static void e(Context context, String logMessageTag, String logMessage, Throwable throwableException) 
    &#123;
    if (!Log.isLoggable(logMessageTag, Log.ERROR))
       return;

    int logResult = Log.e(logMessageTag, logMessage, throwableException);
    if (logResult &gt; 0) 
       logToFile(context, logMessageTag, logMessage + &quot;\r\n&quot; + Log.getStackTraceString(throwableException));
    &#125;

// The i and w method for info and warning logs should be implemented in the same way as the e method for error logs.

/**
   * Sends a message to LogCat and to a log file.
   * @param context The context of the application.
   * @param logMessageTag A tag identifying a group of log messages. Should be a constant in the 
   *                      class calling the logger.
   * @param logMessage The message to add to the log.
   */
 public static void v(Context context, String logMessageTag, String logMessage) 
    &#123;
                              // If the build is not debug, do not try to log, the logcat be 
                              // stripped at compilation.
    if (!BuildConfig.DEBUG || !Log.isLoggable(logMessageTag, Log.VERBOSE))
        return;

    int logResult = Log.v(logMessageTag, logMessage);
    if (logResult &gt; 0) 
       logToFile(context, logMessageTag, logMessage);
    &#125;

/**
   * Sends a message and the exception to LogCat and to a log file.
   * @param logMessageTag A tag identifying a group of log messages. Should be a constant in the 
   *                      class calling the logger.
   * @param logMessage The message to add to the log.
   * @param throwableException An exception to log
   */
 public static void v(Context context,String logMessageTag, String logMessage, Throwable throwableException) 
    &#123;
                              // If the build is not debug, do not try to log, the logcat be 
                              // stripped at compilation.
    if (!BuildConfig.DEBUG || !Log.isLoggable(logMessageTag, Log.VERBOSE))
        return;

    int logResult = Log.v(logMessageTag, logMessage, throwableException);
    if (logResult &gt; 0) 
       logToFile(context, logMessageTag,  logMessage + &quot;\r\n&quot; + Log.getStackTraceString(throwableException));
    &#125;

// The d method for debug logs should be implemented in the same way as the v method for verbose logs.

/**
  * Gets a stamp containing the current date and time to write to the log.
  * @return The stamp for the current date and time.
  */
 private static String getDateTimeStamp()
    &#123;
    Date dateNow = Calendar.getInstance().getTime();
                              // My locale, so all the log files have the same date and time format
    return (DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT, Locale.CANADA_FRENCH).format(dateNow));
    &#125;

/**
  * Writes a message to the log file on the device.
  * @param logMessageTag A tag identifying a group of log messages.
  * @param logMessage The message to add to the log.
  */
 private static void logToFile(Context context, String logMessageTag, String logMessage)
    &#123;
    try
       &#123;
                              // Gets the log file from the root of the primary storage. If it does 
                              // not exist, the file is created.
       File logFile = new File(Environment.getExternalStorageDirectory(), &quot;TestApplicationLog.txt&quot;);
       if (!logFile.exists())
          logFile.createNewFile();
                              // Write the message to the log with a timestamp
       BufferedWriter writer = new BufferedWriter(new FileWriter(logFile, true));
       writer.write(String.format(&quot;%1s [%2s]:%3s\r\n&quot;, getDateTimeStamp(), logMessageTag, logMessage));
       writer.close();
                              // Refresh the data so it can seen when the device is plugged in a 
                              // computer. You may have to unplug and replug to see the latest 
                              // changes
      MediaScannerConnection.scanFile(context, 
                                      new String[] &#123; logFile.toString() &#125;, 
                                      null, 
                                      null);

       &#125;
    catch (IOException e)
       &#123;
       Log.e(&quot;com.cindypotvin.Logger&quot;, &quot;Unable to log exception to file.&quot;);
       &#125;
    &#125;
 &#125;
</code></pre>
<p>If you release an application to the app store or to a client with this kind of logger, you should disable logging by default and add a switch in the preferences to enable logging on demand. If the logger is always enabled, your application will often write to the primary storage and to the logcat, which is an unnecessary overhead when everything works correctly. Also, the size of the log file should be limited in some way to avoid filling up the primary storage.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2015-01-19-Android-log/" data-id="cli8ygt7c002b9y2771ws56wj" data-title="Creating logs in Android applications" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2014-10-26-Android-blur-image" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2014-10-26-Android-blur-image/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.139Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2014-10-26-Android-blur-image/">Android 图片的毛玻璃效果</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><strong>上效果图</strong></li>
</ul>
<p>有很多时候，自己去找别人写的代码，首先会想看一下他的效果图是什么样子的。所以先上效果，<br>以后查找起来也比较方便：</p>
<p><img src="http://pinned.github.io/assets/img/2014-10-26/default.png" alt="Default"><br><img src="http://pinned.github.io/assets/img/2014-10-26/blur.png" alt="Blur Pic"></p>
<ul>
<li><strong>简单实现</strong></li>
</ul>
<p>其实要实现毛玻璃效果，还是挺简单的，Google 给我们提供了一个RenderScript, 看一下代码实现</p>
<pre><code class="java">@TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)
public static Bitmap blurImage(Context context, Bitmap bmp, View view, int radius) &#123;
    float scaleFactor = 1;
    Bitmap overlay = Bitmap.createBitmap((int) (bmp.getWidth() / scaleFactor),
            (int) (bmp.getWidth() / scaleFactor), Bitmap.Config.ARGB_8888);
    Canvas canvas = new Canvas(overlay);
    canvas.translate(-view.getLeft() / scaleFactor, -view.getTop() / scaleFactor);
        canvas.scale(1 / scaleFactor, 1 / scaleFactor);
    Paint paint = new Paint();
    paint.setFlags(Paint.FILTER_BITMAP_FLAG);
    canvas.drawBitmap(bmp, 0, 0, paint);
    RenderScript rs = RenderScript.create(context);
    Allocation overlayAlloc = Allocation.createFromBitmap(rs, overlay);
    ScriptIntrinsicBlur blur = ScriptIntrinsicBlur.create(rs, overlayAlloc.getElement());
    blur.setInput(overlayAlloc);
    blur.setRadius(radius);
    blur.forEach(overlayAlloc);
    overlayAlloc.copyTo(overlay);
    rs.destroy();
    return overlay;
&#125;
private void initView() &#123;
    this.mImageView = (ImageView) this.findViewById(R.id.image_view);
    changeBlur(1);
    mSeekBar = (SeekBar) this.findViewById(R.id.seek_bar);
    mSeekBar.setOnSeekBarChangeListener(new OnSeekBarChangeListener() &#123;
        @Override
        public void onStopTrackingTouch(SeekBar arg0) &#123;
        &#125;
        @Override
        public void onStartTrackingTouch(SeekBar arg0) &#123;
        &#125;
        @Override
        public void onProgressChanged(SeekBar arg0, int arg1, boolean arg2) &#123;
            DebugLog.d(&quot;arg1:&quot; + arg1);
            if (arg1 == 0) &#123;
                arg1 = 1;
            &#125;
            changeBlur(arg1);
        &#125;
    &#125;);
&#125;
private void changeBlur(int radius) &#123;
    Bitmap avatarBg = BitmapFactory.decodeResource(getResources(), R.drawable.pic);
    avatarBg = blurImage(this, avatarBg, this.mImageView, radius);
    mImageView.setImageBitmap(avatarBg);
&#125;
</code></pre>
<p>但是这段代码要在<code>Android JELLY_BEAN_MR1</code>及以上版本才可以使用。</p>
<ul>
<li><strong>改进办法</strong></li>
</ul>
<p>使用第三方写的算法，也是可以实现的。代码如下：</p>
<pre><code class="java">public static Bitmap blurImage(Context context, Bitmap bmp, View view, int radius)&#123;
    float scaleFactor = 1;
    Bitmap overlay = Bitmap.createBitmap((int) (bmp.getWidth()/scaleFactor),
            (int) (bmp.getHeight()/scaleFactor), Bitmap.Config.ARGB_8888);
    Canvas canvas = new Canvas(overlay);
    canvas.translate(-view.getLeft()/scaleFactor, -view.getTop()/scaleFactor);
    canvas.scale(1 / scaleFactor, 1 / scaleFactor);
    Paint paint = new Paint();
    paint.setFlags(Paint.FILTER_BITMAP_FLAG);
    canvas.drawBitmap(bmp, 0, 0, paint);

    overlay = FastBlur.doBlur(overlay, (int)radius, true);
    return overlay;
&#125;
</code></pre>
<p>当然，这里比较重要的是FastBlur这个类，有关图像计算的东东，我也不懂。<br>贴代码 ：</p>
<pre><code class="java">package cn.lovecluo.blurimagedemo.util;

import android.graphics.Bitmap;

public class FastBlur &#123;

    public static Bitmap doBlur(Bitmap sentBitmap, int radius, boolean canReuseInBitmap) &#123;

        // Stack Blur v1.0 from
        // http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html
        //
        // Java Author: Mario Klingemann &lt;mario at quasimondo.com&gt;
        // http://incubator.quasimondo.com
        // created Feburary 29, 2004
        // Android port : Yahel Bouaziz &lt;yahel at kayenko.com&gt;
        // http://www.kayenko.com
        // ported april 5th, 2012

        // This is a compromise between Gaussian Blur and Box blur
        // It creates much better looking blurs than Box Blur, but is
        // 7x faster than my Gaussian Blur implementation.
        //
        // I called it Stack Blur because this describes best how this
        // filter works internally: it creates a kind of moving stack
        // of colors whilst scanning through the image. Thereby it
        // just has to add one new block of color to the right side
        // of the stack and remove the leftmost color. The remaining
        // colors on the topmost layer of the stack are either added on
        // or reduced by one, depending on if they are on the right or
        // on the left side of the stack.
        //
        // If you are using this algorithm in your code please add
        // the following line:
        //
        // Stack Blur Algorithm by Mario Klingemann &lt;mario@quasimondo.com&gt;

        Bitmap bitmap;
        if (canReuseInBitmap) &#123;
            bitmap = sentBitmap;
        &#125; else &#123;
            bitmap = sentBitmap.copy(sentBitmap.getConfig(), true);
        &#125;

        if (radius &lt; 1) &#123;
            return (null);
        &#125;

        int w = bitmap.getWidth();
        int h = bitmap.getHeight();

        int[] pix = new int[w * h];
        bitmap.getPixels(pix, 0, w, 0, 0, w, h);

        int wm = w - 1;
        int hm = h - 1;
        int wh = w * h;
        int div = radius + radius + 1;

        int r[] = new int[wh];
        int g[] = new int[wh];
        int b[] = new int[wh];
        int rsum, gsum, bsum, x, y, i, p, yp, yi, yw;
        int vmin[] = new int[Math.max(w, h)];

        int divsum = (div + 1) &gt;&gt; 1;
        divsum *= divsum;
        int dv[] = new int[256 * divsum];
        for (i = 0; i &lt; 256 * divsum; i++) &#123;
            dv[i] = (i / divsum);
        &#125;

        yw = yi = 0;

        int[][] stack = new int[div][3];
        int stackpointer;
        int stackstart;
        int[] sir;
        int rbs;
        int r1 = radius + 1;
        int routsum, goutsum, boutsum;
        int rinsum, ginsum, binsum;

        for (y = 0; y &lt; h; y++) &#123;
            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = 0;
            for (i = -radius; i &lt;= radius; i++) &#123;
                p = pix[yi + Math.min(wm, Math.max(i, 0))];
                sir = stack[i + radius];
                sir[0] = (p &amp; 0xff0000) &gt;&gt; 16;
                sir[1] = (p &amp; 0x00ff00) &gt;&gt; 8;
                sir[2] = (p &amp; 0x0000ff);
                rbs = r1 - Math.abs(i);
                rsum += sir[0] * rbs;
                gsum += sir[1] * rbs;
                bsum += sir[2] * rbs;
                if (i &gt; 0) &#123;
                    rinsum += sir[0];
                    ginsum += sir[1];
                    binsum += sir[2];
                &#125; else &#123;
                    routsum += sir[0];
                    goutsum += sir[1];
                    boutsum += sir[2];
                &#125;
            &#125;
            stackpointer = radius;

            for (x = 0; x &lt; w; x++) &#123;

                r[yi] = dv[rsum];
                g[yi] = dv[gsum];
                b[yi] = dv[bsum];

                rsum -= routsum;
                gsum -= goutsum;
                bsum -= boutsum;

                stackstart = stackpointer - radius + div;
                sir = stack[stackstart % div];

                routsum -= sir[0];
                goutsum -= sir[1];
                boutsum -= sir[2];

                if (y == 0) &#123;
                    vmin[x] = Math.min(x + radius + 1, wm);
                &#125;
                p = pix[yw + vmin[x]];

                sir[0] = (p &amp; 0xff0000) &gt;&gt; 16;
                sir[1] = (p &amp; 0x00ff00) &gt;&gt; 8;
                sir[2] = (p &amp; 0x0000ff);

                rinsum += sir[0];
                ginsum += sir[1];
                binsum += sir[2];

                rsum += rinsum;
                gsum += ginsum;
                bsum += binsum;

                stackpointer = (stackpointer + 1) % div;
                sir = stack[(stackpointer) % div];

                routsum += sir[0];
                goutsum += sir[1];
                boutsum += sir[2];

                rinsum -= sir[0];
                ginsum -= sir[1];
                binsum -= sir[2];

                yi++;
            &#125;
            yw += w;
        &#125;
        for (x = 0; x &lt; w; x++) &#123;
            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = 0;
            yp = -radius * w;
            for (i = -radius; i &lt;= radius; i++) &#123;
                yi = Math.max(0, yp) + x;

                sir = stack[i + radius];

                sir[0] = r[yi];
                sir[1] = g[yi];
                sir[2] = b[yi];

                rbs = r1 - Math.abs(i);

                rsum += r[yi] * rbs;
                gsum += g[yi] * rbs;
                bsum += b[yi] * rbs;

                if (i &gt; 0) &#123;
                    rinsum += sir[0];
                    ginsum += sir[1];
                    binsum += sir[2];
                &#125; else &#123;
                    routsum += sir[0];
                    goutsum += sir[1];
                    boutsum += sir[2];
                &#125;

                if (i &lt; hm) &#123;
                    yp += w;
                &#125;
            &#125;
            yi = x;
            stackpointer = radius;
            for (y = 0; y &lt; h; y++) &#123;
                // Preserve alpha channel: ( 0xff000000 &amp; pix[yi] )
                pix[yi] = (0xff000000 &amp; pix[yi]) | (dv[rsum] &lt;&lt; 16) | (dv[gsum] &lt;&lt; 8) | dv[bsum];

                rsum -= routsum;
                gsum -= goutsum;
                bsum -= boutsum;

                stackstart = stackpointer - radius + div;
                sir = stack[stackstart % div];

                routsum -= sir[0];
                goutsum -= sir[1];
                boutsum -= sir[2];

                if (x == 0) &#123;
                    vmin[y] = Math.min(y + r1, hm) * w;
                &#125;
                p = x + vmin[y];

                sir[0] = r[p];
                sir[1] = g[p];
                sir[2] = b[p];

                rinsum += sir[0];
                ginsum += sir[1];
                binsum += sir[2];

                rsum += rinsum;
                gsum += ginsum;
                bsum += binsum;

                stackpointer = (stackpointer + 1) % div;
                sir = stack[stackpointer];

                routsum += sir[0];
                goutsum += sir[1];
                boutsum += sir[2];

                rinsum -= sir[0];
                ginsum -= sir[1];
                binsum -= sir[2];

                yi += w;
            &#125;
        &#125;

        bitmap.setPixels(pix, 0, w, 0, 0, w, h);

        return (bitmap);
    &#125;
&#125;
</code></pre>
<ul>
<li><strong>参考资料</strong></li>
</ul>
<blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/paveldudka/blurring">Android blurring sample</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.stylingandroid.com/blurring-images-part-1/">Blurring Images – Part 1</a></li>
<li><a target="_blank" rel="noopener" href="http://segmentfault.com/a/1190000000448785">Andorid 高级模糊技术</a></li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2014-10-26-Android-blur-image/" data-id="cli8ygt75000d9y27e9qldyoy" data-title="Android 图片的毛玻璃效果" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2014-11-03-NullPointException Analysis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/29/2014-11-03-NullPointException%20Analysis/" class="article-date">
  <time class="dt-published" datetime="2023-05-29T02:54:52.139Z" itemprop="datePublished">2023-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/29/2014-11-03-NullPointException%20Analysis/">Android 项目中出现的奇葩bug, 数据NullPointExcption</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在一个自定义的Form表单中，有各种控件，如文本输入框，时间选择器，城市选择器等。<br>在使用城市选择器的时候，城市的数据存储在<code>List</code>中<br>在定义的时候，我使用如下代码定义：</p>
<pre><code class="java">private List&lt;CityNode&gt; mCitys = null;
</code></pre>
<p>经过数据初始化过后，在构造方法中使用<code>mCitys</code>是正常的，但是在其它方法中使用，<br><code>mCitys</code>便成了空值.</p>
<p>这个结果让我非常的费解。</p>
<h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><p>一开始出现了这个空指针异常，排查了好久，根本就找不到任何原因，<br>因为代码本身没有任何的逻辑错误。不知道是运气好还是怎么的。我把那个<code>List</code>的<br>定义写成如下，代码竟然可以正常运行：</p>
<pre><code class="java">private List&lt;CityNode&gt; mCitys;
</code></pre>
<p>看到上面贴出来的代码，我顿时就无语了，太奇怪了，这两个不应该是一样的么。<br>经过一系列的测试，以下是问题解决的步骤:</p>
<ul>
<li>反射</li>
</ul>
<p>先上反射代码：</p>
<pre><code class="java">Class&lt;? extends BaseFormElement&gt; clazz = model.getType().getValue();
BaseFormElement element = null;
try &#123;
    Class[] parameterTypes = &#123; Context.class, FormElementModel.class &#125;;
    //根据参数类型获取相应的构造函数
    Constructor&lt;? extends BaseFormElement&gt; constructor
            = clazz.getConstructor(parameterTypes);
    //参数数组
    Object[] parameters = &#123; mContext, model &#125;;
    //根据获取的构造函数和参数，创建实例
    element = (BaseFormElement)constructor.newInstance(parameters);
&#125; catch (Exception e) &#123;
    e.printStackTrace();
&#125;
</code></pre>
<p>一开始，我以为是由于java的反射机制引起，导致局域变量初始化被执行了两次，<br>可是，有关反射的相关信息，查找了一遍，包括类加载的机制等信息，还是没有能<br>解释代码为什么执行了两次，所以觉得不怎么像是他引起的。后面和一个同事说到，<br>他看了一下代码，开始也没有找到原因,后面他说对象强转型引起的。</p>
<ul>
<li>强制转型</li>
</ul>
<p>在使用反射的时候，<code>newInstance</code>创建一个对象，返回了一个父类型的变量，可是<br>根本就没有进行强制转换。</p>
<ul>
<li>构造方法的执行顺序</li>
</ul>
<p>还是抱着局域变量的初始化被执行了两次，打印了一下日志，终于发现了问题的所在。<br>在初始化一个对象的时候，首先是执行父类的构造方法，如果还有父类，继续向上查找。</p>
<p>示例：</p>
<pre><code class="java">public class A &#123;
    &#123;
        System.out.println(&quot;class a prarms init&quot;);
    &#125;
    public A() &#123;
        System.out.println(&quot;A constructor method excute&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class B extends A &#123;
    &#123;
        System.out.println(&quot;class B params init&quot;);
    &#125;
    public B() &#123;
        System.out.println(&quot;B constructor method excute&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">public class Main &#123;

    public static void main(String[] args) &#123;
        A a = new B();
    &#125;
&#125;
</code></pre>
<p>运行结果:</p>
<pre><code class="html">class a prarms init
A constructor method excute
class B params init
B constructor method excute
</code></pre>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这一次的空指针的最根本原因是在父类的构造方法中执行了子类实例变量的初始化<br>操作，这是一个非常不合理的举动。如果子类属性中的东西应该在子类中进行初始化，<br>而不是在父类中调用初始化方法。</p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p><del>代码木有上传上来，如果你想看看这个丑陋的代码是怎么写的，你可以邮件联系我：<br><a href="mailto:&#x6c;&#x6f;&#118;&#101;&#99;&#108;&#x75;&#x6f;&#64;&#110;&#105;&#103;&#104;&#116;&#x77;&#x65;&#97;&#118;&#101;&#x72;&#46;&#111;&#114;&#x67;">&#x6c;&#x6f;&#118;&#101;&#99;&#108;&#x75;&#x6f;&#64;&#110;&#105;&#103;&#104;&#116;&#x77;&#x65;&#97;&#118;&#101;&#x72;&#46;&#111;&#114;&#x67;</a></del></p>
<p>更新代码地址：</p>
<ul>
<li><a href="http://pinned.github.io/assets/posts/file-2014-11-4/NullPointProject-bug.tar.gz">Bug版代码</a></li>
<li><a href="http://pinned.github.io/assets/posts/file-2014-11-4/NullPointProject-%E6%9B%B4%E6%94%B9.rar">修改版本</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pinned.github.io/2023/05/29/2014-11-03-NullPointException%20Analysis/" data-id="cli8ygt76000l9y27bfk50457" data-title="Android 项目中出现的奇葩bug, 数据NullPointExcption" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">开源项目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F/">系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Camera/" rel="tag">Android Camera</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Gradle/" rel="tag">Android Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Network/" rel="tag">Android Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proguard/" rel="tag">Proguard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby-Ubuntu/" rel="tag">Ruby Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Systems/" rel="tag">Systems</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools-Android/" rel="tag">Tools Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools-Ruby/" rel="tag">Tools Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools-Ruby-Rails/" rel="tag">Tools Ruby Rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools-SVN-Git/" rel="tag">Tools SVN Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools-Systems/" rel="tag">Tools Systems</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu-Systems-Tools/" rel="tag">Ubuntu Systems Tools</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Android-Camera/" style="font-size: 10px;">Android Camera</a> <a href="/tags/Android-Gradle/" style="font-size: 12.5px;">Android Gradle</a> <a href="/tags/Android-Network/" style="font-size: 12.5px;">Android Network</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Proguard/" style="font-size: 10px;">Proguard</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Ruby-Ubuntu/" style="font-size: 10px;">Ruby Ubuntu</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Systems/" style="font-size: 12.5px;">Systems</a> <a href="/tags/Tools/" style="font-size: 17.5px;">Tools</a> <a href="/tags/Tools-Android/" style="font-size: 15px;">Tools Android</a> <a href="/tags/Tools-Ruby/" style="font-size: 10px;">Tools Ruby</a> <a href="/tags/Tools-Ruby-Rails/" style="font-size: 10px;">Tools Ruby Rails</a> <a href="/tags/Tools-SVN-Git/" style="font-size: 10px;">Tools SVN Git</a> <a href="/tags/Tools-Systems/" style="font-size: 10px;">Tools Systems</a> <a href="/tags/Ubuntu-Systems-Tools/" style="font-size: 12.5px;">Ubuntu Systems Tools</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/29/2017-10-15-gradlew%20source%20analyze/">gradlew 源码分析</a>
          </li>
        
          <li>
            <a href="/2023/05/29/2017-02-10-proguard-translate/">Proguard 翻译</a>
          </li>
        
          <li>
            <a href="/2023/05/29/2019-05-21-Android-camera-preview/">Android Camera Preview</a>
          </li>
        
          <li>
            <a href="/2023/05/29/2019-08-10-Android-network-Configuration/">Android 网络配置</a>
          </li>
        
          <li>
            <a href="/2023/05/29/2019-08-10-Android-network-security-configuration/">Android Network security configuration</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 罗昭成<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>